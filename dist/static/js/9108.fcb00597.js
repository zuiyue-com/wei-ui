/*!
 *  build: Vue  Admin Plus
 *  copyright: vue-admin-beautiful.com
 *  time: 2023-10-16 10:23:30
 */
"use strict";(self["webpackChunkadmin_plus"]=self["webpackChunkadmin_plus"]||[]).push([[9108],{24025:function(t,e,a){a.d(e,{BB:function(){return i},BN:function(){return r},N7:function(){return y},NY:function(){return u},PM:function(){return m},Xq:function(){return h},Z0:function(){return l},kA:function(){return d},l0:function(){return p},mE:function(){return f},wR:function(){return c},xS:function(){return w},yX:function(){return s},yo:function(){return g}});var n=a(52806),o=a(12688);function s(){return(0,n.Z)({url:"/wwwapi.php?to=sd&modac=tags",method:"get"})}function i(t){return(0,n.Z)({url:"/wwwapi.php?to=postSd&filter=heat&orderby=heats",method:"get",params:t})}function r(t){return(0,n.Z)({url:"/wwwapi.php?to=postSdView&extra=",method:"get",params:t})}function c(t){return(0,n.Z)({url:"/wwwapi.php?to=postSdOfUser",method:"get",params:t})}async function u(t){const{body:{hash:e}}=await(0,o.Gv)();return(0,n.Z)({url:"/wwwapi.php?to=postReply",method:"post",data:{file:"",subject:"",usesig:"1",replysubmit:"yes",formhash:e,tid:t.tid,message:t.message}})}async function d(t){const{body:{hash:e}}=await(0,o.Gv)();return(0,n.Z)({url:"/wwwapi.php?to=postReply",method:"post",data:{subject:"",usesig:"1",replysubmit:"yes",formhash:e,...t}})}async function l(t){const{body:{hash:e}}=await(0,o.Gv)();return t.formhash=e,(0,n.Z)({url:"/wwwapi.php?to=postDel",method:"post",data:t})}async function p(t){const{body:{hash:e}}=await(0,o.Gv)();return(0,n.Z)({url:"/wwwapi.php?to=postFavAdd",method:"get",params:{id:t,formhash:e}})}async function h(t){const{body:{hash:e}}=await(0,o.Gv)();return(0,n.Z)({url:"/wwwapi.php?to=postFavDel",method:"post",data:{favid:t,formhash:e}})}function m(t){return(0,n.Z)({url:"/wwwapi.php?to=postFavlist",method:"get",params:t})}async function f(t){const{body:{hash:e}}=await(0,o.Gv)();return(0,n.Z)({url:"/wwwapi.php?to=postLikes",method:"get",params:{tid:t,hash:e}})}async function g(t){const{body:{hash:e}}=await(0,o.Gv)();return(0,n.Z)({url:"/wwwapi.php?to=postReport",method:"post",data:{referer:"",reportsubmit:"true",rtype:"post",url:"",inajax:"1",handlekey:`miscreport${t.rid}`,formhash:e,...t}})}async function w(t){const e={...t};e.tags=e.tags.join(",");const{body:{hash:a}}=await(0,o.Gv)();return(0,n.Z)({url:"/wwwapi.php?to=sd&modac=sharePrepare",method:"post",data:{formhash:a,...e}})}async function y(t){return(0,n.Z)({url:"/wwwapi.php?to=sdpost",method:"post",data:t})}},5649:function(t,e,a){a.d(e,{o:function(){return u}});a(57658);var n=a(24025),o=a(81095),s=a(30582),i=a(17052),r=a(47720);const c=(0,s.L)(),u=(0,r.Q_)("topic",{state:()=>({queryForm:{tid:0,page:1},detail:{},comments:[],extraInfo:{},pagination:{pageSize:1,total:1},favId:0,likeId:0}),getters:{canAction(){return c.canAction(this.detail.authorid)},getTopicUserId(){return this.detail.authorid},getTopicTags(){return this.detail.tags?this.detail.tags.map((t=>({id:t[0],name:t[1]}))):[]},getTopicImages(){return this.detail.attachments?Object.values(this.detail.attachments).map((t=>({id:t.aid,image:`${t.url}${t.attachment}`,height:t.height}))):[]},getTopicImagesMaxHeight(){const t=this.getTopicImages.map((t=>t.height));return Math.max(...t)},getTid(){return this.detail.tid},getPid(){return this.detail.pid},hasNoMoreData(){return(0,i.Gc)(this.queryForm.page,this.pagination.pageSize,this.pagination.total-1)}},actions:{setTopic(t){this.queryForm.tid=t},async loadTopic(){const{body:{list:t,forum_thread:e,page_perpage:a,page_allcount:o}}=await(0,n.BN)(this.queryForm),s=t;this.detail=s[0]??{},this.comments=s.slice(1),this.extraInfo=e,this.pagination.pageSize=parseInt(a),this.pagination.total=parseInt(o),this.favId=this.detail.threadHasFavorite?.favid??0,this.likeId=this.detail.threadHasRecommend?.tid??0},async loadAddedTopic(){const{body:{list:t,forum_thread:e,page_perpage:a,page_allcount:o}}=await(0,n.BN)(this.queryForm);this.comments=[t[1],...this.comments],this.extraInfo=e,this.pagination.pageSize=parseInt(a),this.pagination.total=parseInt(o)},async loadMoreComments(){if(this.hasNoMoreData)return;this.queryForm.page++;const{body:{list:t}}=await(0,n.BN)(this.queryForm);this.comments.push(...t)},async handleAddFavTopic(){const{body:{favid:t}}=await(0,n.l0)(this.getTid);t>0?(this.favId=t,this.extraInfo.favtimes++,o.gp.$baseMessage("收藏成功","success","vab-hey-message-success")):o.gp.$baseMessage("收藏失败","error","vab-hey-message-error")},async handleDelFavTopic(){await(0,n.Xq)(this.favId),this.favId=0,this.extraInfo.favtimes--,o.gp.$baseMessage("取消收藏成功","success","vab-hey-message-success")},async handleAddLikeTopic(){if(!this.canAction)return;const{body:{recommendv:t}}=await(0,n.mE)(this.getTid);this.likeId=t,this.extraInfo.recommend_add++}}})},17052:function(t,e,a){a.d(e,{D8:function(){return r},Gc:function(){return i},TD:function(){return n},Vj:function(){return o},eK:function(){return s}});a(57658);function n(t,e){if(0===arguments.length)return null;const a=e||"{y}-{m}-{d} {h}:{i}:{s}";let n;"object"===typeof t?n=t:("string"===typeof t&&/^[0-9]+$/.test(t)&&(t=parseInt(t)),"number"===typeof t&&10===t.toString().length&&(t*=1e3),n=new Date(t));const o={y:n.getFullYear(),m:n.getMonth()+1,d:n.getDate(),h:n.getHours(),i:n.getMinutes(),s:n.getSeconds(),a:n.getDay()};return a.replace(/{([ymdhisa])+}/g,((t,e)=>{let a=o[e];return"a"===e?["日","一","二","三","四","五","六"][a]:(t.length>0&&a<10&&(a=`0${a}`),a||0)}))}function o(t=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";let a="";for(let n=0;n<t;n++)a+=e.charAt(Math.floor(Math.random()*e.length));return a}function s(t){const e=t.match(/src="(.+?)"/);return e?e[1]:t}function i(t,e,a){const n=Math.ceil(a/e);return t>=n}function r(t=0){document.getElementById("app").scrollTo({top:t,left:0,behavior:"smooth"})}},58504:function(t,e,a){a.d(e,{x:function(){return i}});var n=a(19635),o=a(96486),s=a.n(o);function i(t){const e=s().pick(t,["tid","fid","pid","authorid","avatar","author","subject","message","dateline"]);return e.author_route=(0,n.gx)(e.authorid),e}},44587:function(t,e,a){a.r(e),a.d(e,{default:function(){return p}});var n=a(4350),o=(a(3241),a(91103),a(31452)),s=(a(68445),a(66252)),i=a(3577);const r={key:0,class:"loading"};var c={__name:"show",props:{status:{type:String,default:"loadmore"},align:{type:String,default:"end"},clicked:{type:Boolean,default:!1}},emits:["loadmore","reset"],setup(t,{emit:e}){function a(){e("loadmore")}function c(){e("reset")}return(e,u)=>{const d=o.E2,l=n.t;return(0,s.wg)(),(0,s.iD)("div",{class:(0,i.C_)(["wrap aligin-center","justify-"+t.align])},["loading"==t.status?(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",r,null,512)),[[l,!0]]):(0,s.kq)("",!0),t.clicked?((0,s.wg)(),(0,s.j4)(d,{key:1,type:"primary",onClick:c},{default:(0,s.w5)((()=>[(0,s.Uk)("收起")])),_:1})):(0,s.kq)("",!0),(0,s.Wm)(d,{type:"primary",onClick:a},{default:(0,s.w5)((()=>[(0,s.Uk)("更多")])),_:1})],2)}}};function u(t){t.__source="src/components/LoadMore/show.vue"}var d=a(83744);"function"===typeof u&&u(c);const l=(0,d.Z)(c,[["__scopeId","data-v-6bf37098"]]);var p=l},60496:function(t,e,a){a.r(e),a.d(e,{default:function(){return L}});var n=a(10661),o=(a(3241),a(35095),a(14181)),s=(a(33828),a(77669)),i=(a(95774),a(66252)),r=a(2262),c=a(3577),u=a(44587),d=a(24025),l=a(58504),p=a(30582),h=a(5649),m=a(47720);const f={class:"comments"},g={class:"row"},w={class:"content-box"},y={class:"user-box"},v={class:"author"},k=["innerHTML"],b={class:"message"},_=["innerHTML"],M=["innerHTML"];var I={__name:"comments",emits:["reply","report"],setup(t,{emit:e}){const a=(0,i.f3)("$baseConfirm"),I=(0,i.f3)("$baseMessage"),T=(0,h.o)(),{hasNoMoreData:D}=(0,m.Jk)(T),x=(0,p.L)(),{getUserId:L}=(0,m.Jk)(x),Z=(0,r.qj)({clickedLoadMore:!1,showAllGenerateParams:!1}),F=(0,i.Fl)((()=>T.comments.map((t=>{const e=(0,l.x)(t);return e.canDelete=L.value==t.authorid,e})))),S=(0,i.Fl)((()=>{const t=Z.clickedLoadMore?F.value.length:4;return F.value.slice(0,t)})),q=(0,i.Fl)((()=>F.value.length>4));function C(t){e("reply",t.pid,t.author)}async function j(t){a("你确定要删除此帖子吗？",null,(async()=>{const e={tid:t.tid,fid:t.fid,pid:t.pid};await(0,d.Z0)(e),T.loadTopic(),I("删除成功！","success","vab-hey-message-success")}))}async function W(){Z.clickedLoadMore?(D.value&&I("没有更多数据了","info"),T.loadMoreComments()):Z.clickedLoadMore=!0}async function G(){Z.clickedLoadMore=!1}async function H(t){e("report",t.pid,t.fid)}return(t,e)=>{const a=s.vs,d=(0,i.up)("router-link"),l=(0,i.up)("ChatDotSquare"),p=o.gn,h=n.Q0,m=(0,i.up)("Bell"),I=(0,i.up)("Delete");return(0,i.wg)(),(0,i.iD)("div",f,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)((0,r.SU)(S),(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.pid,class:"item"},[(0,i._)("div",g,[(0,i.Wm)(d,{to:t.author_route},{default:(0,i.w5)((()=>[(0,i.Wm)(a,{src:t.avatar},null,8,["src"])])),_:2},1032,["to"]),(0,i._)("div",w,[(0,i._)("div",y,[(0,i.Wm)(d,{to:t.author_route},{default:(0,i.w5)((()=>[(0,i._)("div",v,(0,c.zw)(t.author),1)])),_:2},1032,["to"]),(0,i._)("div",{class:"date",innerHTML:t.dateline},null,8,k),(0,i.Wm)(h,{class:"box-item",effect:"dark",content:"回复",placement:"top"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{onClick:e=>C(t)},{default:(0,i.w5)((()=>[(0,i.Wm)(l)])),_:2},1032,["onClick"])])),_:2},1024),(0,i.Wm)(h,{class:"box-item",effect:"dark",content:"举报",placement:"top"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{style:{color:"var(--el-color-warning)"},class:"cursor-pointer",onClick:e=>H(t)},{default:(0,i.w5)((()=>[(0,i.Wm)(m)])),_:2},1032,["onClick"])])),_:2},1024),t.canDelete?((0,i.wg)(),(0,i.j4)(h,{key:0,class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{style:{color:"var(--el-color-danger)"},onClick:e=>j(t)},{default:(0,i.w5)((()=>[(0,i.Wm)(I)])),_:2},1032,["onClick"])])),_:2},1024)):(0,i.kq)("",!0)]),(0,i._)("div",b,[(0,i._)("span",{innerHTML:t.subject},null,8,_),(0,i._)("span",{innerHTML:t.message},null,8,M)])])])])))),128)),(0,r.SU)(q)?((0,i.wg)(),(0,i.j4)((0,r.SU)(u["default"]),{key:0,clicked:(0,r.SU)(Z).clickedLoadMore,onLoadmore:W,onReset:G},null,8,["clicked"])):(0,i.kq)("",!0)])}}};function T(t){t.__source="src/views/topic/components/comments.vue"}var D=a(83744);"function"===typeof T&&T(I);const x=(0,D.Z)(I,[["__scopeId","data-v-5b49de28"]]);var L=x}}]);