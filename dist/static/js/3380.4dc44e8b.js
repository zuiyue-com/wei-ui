/*!
 *  build: Vue  Admin Plus
 *  copyright: vue-admin-beautiful.com
 *  time: 2023-10-12 09:18:53
 */
"use strict";(self["webpackChunkadmin_plus"]=self["webpackChunkadmin_plus"]||[]).push([[3380,7280],{95244:function(e,i,t){t.d(i,{Ix:function(){return r},R1:function(){return s},_5:function(){return o},ss:function(){return n}});var a=t(52806);function s(){return(0,a.Z)({url:"/wwwapi.php?to=sd&modac=formbase",method:"get"})}function r(e,i){const t=new FormData;return t.append("Filedata",e.file),(0,a.Z)({url:"/wwwapi.php?to=sd&modac=upload",method:"post",headers:{"Content-Type":"multipart/form-data"},data:t,...i})}function n(e){return(0,a.Z)({url:"/wwwapi.php?to=sd&modac=myworks",method:"get",params:e})}function o(e){return(0,a.Z)({url:"/wwwapi.php?to=sd&modac=cancle",method:"post",data:{misId:e}})}},91222:function(e,i,t){t.d(i,{m:function(){return d}});var a=t(95244),s=t(15592),r=t(96486),n=t.n(r),o=t(47720);const d=(0,o.Q_)("imageModel",{state:()=>({formType:"basic",basicFormTemp:{sd_model_checkpoint_name:"",size:"Portrait"},basicForm:{taskType:"txt2img",override_settings:{sd_model_checkpoint:"",sd_vae:""},styles:[],prompt_words:"",negative_prompt_words:"",init_images:[],width:128,height:1536,sampler_index:"",num_samples:0,cfg_scale:0,seed:-1,clip_skip:0,ensd:31337,batch_size:1},basicOptions:{Checkpoints:[],loraStyle:[],sdVae:{},imageSize:{},imageSizeCustom:{},samplerMethod:[],samplerStep:{},CFGScale:{},clipSkip:{}},hdrepaireForm:{taskType:"HD",base_image:{},hr_upscaler:"",hr_scale:"2",hr_resize_x:0,hr_resize_y:0,hr_second_pass_steps:0,denoising_strength:0},hdrepaireOptions:{hrImageSize:{},imageSizeCustom:{},hrUpscaler:{},hrSecondPassSteps:{}},adetailerForm:{taskType:"AD",base_image:{},ad_model:"",styles:[],ad_prompt_words:"",ad_negative_prompt_words:"",ad_confidence:0,ad_dilate_erode:0,ad_denoising_strength:0,ad_inpaint_only_masked:1},adetailerOptions:{adModel:{},loraStyle:[],adConfidence:{},adMaskBlur:{},adDenoisingStrength:{}}}),getters:{isCustomImageSize(e){return"Custom"===e.basicFormTemp.size},isHdrepaireCustomImageSize(e){return"custom"===e.hdrepaireForm.hr_scale},hasUploadedImage(e){return e.basicForm.init_images.length>0}},actions:{setFormType(e){this.formType=e},formatLoraStyle(e){return Object.entries(e).map((e=>{const[i,t]=e,a=n().cloneDeep(t);a.key=i,a.checked=!1;const[s,r,o]=a.weight;return a.weight={min:s,max:r,value:o},a}))},initBasic({Checkpoints:e,loraStyle:i,sdVae:t,imageSize:a,samplerMethod:s,samplerStep:r,CFGScale:n,clipSkip:o}){const d=Object.entries(e).map((e=>{const[i,t]=e;return t.key=i,t})),l=this.formatLoraStyle(i),m={Checkpoints:d,loraStyle:l,sdVae:t,imageSize:a,imageSizeCustom:{...this.getCustomImageSizeParams(a)},samplerMethod:s,samplerStep:{min:r[0]??1,max:r[1]??60},CFGScale:{min:n[0]??1,max:n[1]??30},clipSkip:{min:o[0]??1,max:o[1]??12}};this.basicOptions=m;const c=m.imageSize[this.basicFormTemp.size];this.setSdModel(d[0]??{}),this.basicForm.override_settings.sd_vae=t["default"],this.basicForm.width=c[0],this.basicForm.height=c[1],this.basicForm.sampler_index=s[0]??"",this.basicForm.num_samples=r[2]??1,this.basicForm.cfg_scale=n[2]??1,this.basicForm.clip_skip=o[2]??1},initHdrepaire({hrImageSize:e,hrUpscaler:i,hrSecondPassSteps:t,denoisingStrength:a}){const s={hrImageSize:e,hrUpscaler:i,hrSecondPassSteps:{min:t[0],max:t[1]},denoisingStrength:{min:a[0],max:a[1]},imageSizeCustom:{...this.getCustomImageSizeParams(e)}};this.hdrepaireOptions=s;const r=s.hrImageSize[this.hdrepaireForm.hr_scale];this.hdrepaireForm.hr_resize_x=r[0],this.hdrepaireForm.hr_resize_y=r[1],this.hdrepaireForm.hr_upscaler=i["default"],this.hdrepaireForm.hr_second_pass_steps=t[2],this.hdrepaireForm.denoising_strength=a[2]},initAdetailer({adModel:e,loraStyle:i,adConfidence:t,adMaskBlur:a,adDenoisingStrength:s}){const r=this.formatLoraStyle(i),n={adModel:e,loraStyle:r,adConfidence:{min:t[0],max:t[1]},adMaskBlur:{min:a[0],max:a[1]},adDenoisingStrength:{min:s[0],max:s[1]}};this.adetailerOptions=n,this.adetailerForm.ad_model=e["0"],this.adetailerForm.ad_confidence=t[2],this.adetailerForm.ad_dilate_erode=a[2],this.adetailerForm.ad_denoising_strength=s[2]},async load(){const{body:e}=await(0,a.R1)();this.initBasic(e),this.initHdrepaire(e),this.initAdetailer(e)},getCustomImageSizeParams(e){const i=e["Custom"]?e["Custom"]:e["custom"];return{minWidth:i[0],maxWidth:i[1],minHeight:i[2],maxHeight:i[3],defaultWidth:i[4],defaultHeight:i[5]}},setUploadImage(e){const i=e.map((e=>({picid:e.picid,url:e.bigimg,title:e.title})));this.basicForm.init_images=i},setSdModel(e){this.basicFormTemp.sd_model_checkpoint_name=e.name,this.basicForm.override_settings.sd_model_checkpoint=e.key},getUploadImages(){return this.basicForm.init_images.map((async e=>{const{width:i,height:t,src:a}=await(0,s.I)(e.raw);let r="";return i&&(r=`图片大小 ${i}x${t}`),e.extra=r,e.url=a,e}))},hdSetUploadImage(e){const i={picid:e.picid,url:e.bigimg,title:e.title};this.hdrepaireForm.base_image=i},adSetUploadImage(e){const i={picid:e.picid,url:e.bigimg,title:e.title};this.adetailerForm.base_image=i},createImage(){let e={};switch(this.formType){case"hdrepaire":e={...this.hdrepaireForm},e.base_image.url&&(e.base_image=e.base_image.url);break;case"adetailer":e={...this.adetailerForm},e.base_image.url&&(e.base_image=e.base_image.url);break;case"basic":default:e={...this.basicForm},e.styles=e.styles.map((e=>{const i={name:e.key,weight:e.weight};return i})),e.init_images=e.init_images.map((e=>{const i=e.url;return i})),e.init_images.length>0&&(e.taskType="img2img");break}console.log(e)}}})},15592:function(e,i,t){function a(e){return new Promise(((i,t)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=function(){if(2==a.readyState){const e=new Image;e.src=a.result,e.onload=function(){const e={width:this.width,height:this.height,src:this.src};i(e)}}else t()}}))}function s(e){return e.replace(/data:.+?;base64,/,"")}t.d(i,{I:function(){return a},x:function(){return s}})},97280:function(e,i,t){t.r(i),t.d(i,{default:function(){return g}});var a=t(66252);const s={class:"el-card el-upload-dragger list-item"},r={class:"list-item-meta"},n={class:"list-item-meta-avatar"},o={class:"list-item-meta-content"},d={class:"card-header"},l={class:"list-item-meta-action"};function m(e,i){return(0,a.wg)(),(0,a.iD)("div",s,[(0,a._)("div",r,[(0,a._)("div",n,[(0,a.WI)(e.$slots,"image",{},void 0,!0)]),(0,a._)("div",o,[(0,a._)("div",d,[(0,a.WI)(e.$slots,"header",{},void 0,!0)]),(0,a.WI)(e.$slots,"content",{},void 0,!0)]),(0,a._)("div",l,[(0,a.WI)(e.$slots,"action",{},void 0,!0)])])])}function c(e){e.__source="src/components/CardItem/index.vue"}var p=t(83744);const h={};"function"===typeof c&&c(h);const u=(0,p.Z)(h,[["render",m],["__scopeId","data-v-4186fb5a"]]);var g=u},73380:function(e,i,t){t.r(i),t.d(i,{default:function(){return b}});var a=t(4350),s=(t(3241),t(91103),t(61046)),r=(t(19414),t(79329)),n=(t(68984),t(66252)),o=t(2262),d=t(49963),l=t(3577),m=t(91222),c=t(97280),p=t(15592),h=t(95244),u=t(47720);const g=(0,n._)("div",{class:"el-upload__text"},[(0,n.Uk)(" 把图片拖放到这里 / "),(0,n._)("em",null,"点击这里上传")],-1),_={key:0,class:"width-100"};var f={__name:"upload",setup(e){const i=(0,m.m)(),{basicFormTemp:t,basicForm:f,hasUploadedImage:w}=(0,u.Jk)(i),{setUploadImage:S}=i,b=(0,o.iH)(null),F=(0,o.iH)([]),y=(0,n.Fl)((()=>F.value.length));(0,n.YP)(y,(async()=>{F.value.map((async e=>{const{width:i,height:t,src:a}=await(0,p.I)(e.raw),s={url:a,picid:0,uid:e.uid,percent:0,title:`图片大小 ${i}x${t}`};e.meta=s,S([s])}))}));let v=null;function k(){v&&v.abort(),b.value.clearFiles(),S([])}async function I(e,i){if(!e.msg)return b.value.clearFiles(),void S([]);const{body:{picid:t,url:a},msg:s}=e,{width:r,height:n}=await(0,p.I)(i.raw),o={url:a,picid:t,uid:i.uid,percent:100,title:i.meta.title??""};S([o])}async function C(e){return v=new AbortController,(0,h.Ix)(e,{signal:v.signal})}return(e,i)=>{const t=r.LW,m=s.F8,p=(0,n.up)("vab-icon"),h=a.t;return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.wy)((0,n.Wm)(t,{ref_key:"uploadRef",ref:b,"file-list":(0,o.SU)(F),"onUpdate:fileList":i[0]||(i[0]=e=>(0,o.dq)(F)?F.value=e:null),action:"http://localhost:15000/api/wwwapi.php?to=sd&modac=upload","on-success":I,"http-request":C,drag:"",limit:1,"auto-upload":!0,"show-file-list":!1,class:"upload-demo"},{default:(0,n.w5)((()=>[g])),_:1},8,["file-list"]),[[d.F8,!(0,o.SU)(w)]]),(0,o.SU)(w)?((0,n.wg)(),(0,n.iD)("div",_,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,o.SU)(f).init_images,(e=>((0,n.wg)(),(0,n.j4)((0,o.SU)(c["default"]),{key:e},{image:(0,n.w5)((()=>[(0,n.wy)((0,n.Wm)(m,{src:e.url,width:"48",class:"upload-image"},null,8,["src"]),[[h,0===e.picid]])])),header:(0,n.w5)((()=>[(0,n._)("span",null,(0,l.zw)(e.title),1)])),action:(0,n.w5)((()=>[(0,n.Wm)(p,{icon:"delete-bin-6-line",style:{color:"var(--el-color-danger)"},onClick:k})])),_:2},1024)))),128))])):(0,n.kq)("",!0)],64)}}};function w(e){e.__source="src/views/stablediffusion/components/upload.vue"}"function"===typeof w&&w(f);const S=f;var b=S}}]);